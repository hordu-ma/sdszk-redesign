# 脚本路径修复说明

## 问题描述

在项目文件整理过程中，我们将主目录和 `scripts/` 目录下的脚本文件重新分类整理到了不同的子目录中。但是在整理过程中，GitHub Actions 配置文件和 package.json 中的脚本路径引用没有同步更新，导致 CI 构建失败。

## 修复内容

### 🗂️ **脚本文件重新组织**

**原始结构**：
```
scripts/
├── deploy-backend.sh
├── deploy.sh
├── test-mongodb.sh
├── wait-services-simple.sh
├── ...
```

**新结构**：
```
scripts/
├── ci/                   # CI相关脚本
│   ├── ci-start.sh
│   ├── ci-stop.sh
│   ├── wait-services-simple.sh
│   └── wait-services.sh
├── database/             # 数据库相关脚本
│   ├── mongodb-tunnel.sh
│   ├── quick-sync.sh
│   ├── sync-database.sh
│   └── verify-database.sh
├── deployment/           # 部署相关脚本
│   ├── deploy-backend.sh
│   ├── deploy.sh
│   ├── deploy-nginx.sh
│   └── deploy-prod.sh
├── development/          # 开发相关脚本
│   ├── cleanup-project.sh
│   ├── clear-cache.sh
│   ├── debug-services.sh
│   ├── dev-start.sh
│   ├── dev-stop.sh
│   ├── diagnose-backend.sh
│   ├── monitor.sh
│   └── setup-dev-env.sh
├── testing/              # 测试相关脚本
│   ├── test-frontend-performance.js
│   ├── test-mongodb.sh
│   ├── test-redis-enhanced.sh
│   └── test-redis.sh
├── github-actions/       # GitHub Actions 相关
└── pinia-persistence/    # Pinia 持久化相关
```

### 🔧 **路径引用修复**

#### 1. GitHub Actions 配置文件

**文件**: `.github/workflows/playwright.yml`
```diff
- bash scripts/wait-services-simple.sh --timeout 180 --verbose
+ bash scripts/ci/wait-services-simple.sh --timeout 180 --verbose

- ./scripts/test-mongodb.sh
+ ./scripts/testing/test-mongodb.sh

- REDIS_HOST=localhost ./scripts/test-redis-enhanced.sh
+ REDIS_HOST=localhost ./scripts/testing/test-redis-enhanced.sh
```

**文件**: `.github/workflows/ci.yml`
```diff
- bash scripts/wait-services-simple.sh --timeout 120 --verbose
+ bash scripts/ci/wait-services-simple.sh --timeout 120 --verbose

- ./scripts/test-mongodb.sh
+ ./scripts/testing/test-mongodb.sh

- ./scripts/test-redis.sh
+ ./scripts/testing/test-redis.sh
```

#### 2. Package.json 脚本配置

**文件**: `package.json`
```diff
- "deploy:backend": "bash scripts/deploy-backend.sh"
+ "deploy:backend": "bash scripts/deployment/deploy-backend.sh"

- "deploy:aliyun": "bash scripts/deploy-frontend.sh"
+ "deploy:aliyun": "bash scripts/deployment/deploy.sh"

- "db:sync": "bash scripts/quick-sync.sh"
+ "db:sync": "bash scripts/database/quick-sync.sh"

- "db:sync-full": "bash scripts/sync-database.sh"
+ "db:sync-full": "bash scripts/database/sync-database.sh"

- "db:tunnel": "bash scripts/mongodb-tunnel.sh"
+ "db:tunnel": "bash scripts/database/mongodb-tunnel.sh"

- "db:verify": "bash scripts/verify-database.sh"
+ "db:verify": "bash scripts/database/verify-database.sh"
```

#### 3. 清理不存在的脚本引用

移除了不存在的脚本引用：
```diff
- "test:api": "node scripts/test-api-connectivity.mjs"
```

### 🧹 **临时文件清理**

删除了以下临时文件：
- `frontend.log` - 前端运行日志文件
- `dump.rdb` - Redis 数据dump文件
- `.DS_Store` - macOS 系统文件

### ⚙️ **权限修复**

确保所有脚本文件具有执行权限：
```bash
chmod +x scripts/**/*.sh
```

## 验证结果

### ✅ **本地测试通过**
```bash
npm run test:e2e:basic
# ✅ 15 passed (30.1s)
```

### 🔍 **文件结构验证**
```bash
# 检查脚本分类
ls scripts/*/
# ci/ database/ deployment/ development/ testing/
```

## 影响评估

### 🎯 **解决的问题**
1. **CI 构建失败** - 修复了 GitHub Actions 中的脚本路径引用错误
2. **Package.json 错误** - 更新了所有 npm 脚本的路径引用
3. **文件组织混乱** - 按功能分类整理了所有脚本文件
4. **临时文件堆积** - 清理了不必要的临时文件

### 📋 **需要注意的事项**
1. **文档更新** - 其他文档中的脚本路径引用可能需要后续更新
2. **团队通知** - 需要通知团队成员新的脚本目录结构
3. **IDE 配置** - 可能需要更新 IDE 中的运行配置

## 后续优化建议

### 📖 **文档同步**
- 更新 README.md 中的部署说明
- 更新开发指南中的脚本使用说明
- 创建脚本功能索引文档

### 🔒 **路径稳定性**
- 在 CI 配置中使用相对路径避免硬编码
- 考虑创建脚本别名或软链接
- 添加路径验证测试

### 🚀 **自动化改进**
- 创建脚本路径检查工具
- 添加 pre-commit hook 验证脚本引用
- 考虑使用配置文件统一管理脚本路径

---

**修复时间**: 2024年12月19日
**修复版本**: v1.1.1
**状态**: ✅ 已完成并验证
**影响范围**: CI/CD 流程、本地开发脚本、文件组织结构
