---
title: 测试基线现状
updated: 2025-09-29
status: draft
owner: qa-team
---

# 测试基线现状

来源：覆盖率评估与现有 **tests** 清点。策略参见 `testing-strategy.md`，演进计划见 `testing-roadmap.md`。

## 📊 覆盖率概览 (基准)

| 指标 | 当前   | 目标 | 状态 |
| ---- | ------ | ---- | ---- |
| 语句 | 2.93%  | 85%  | ❌   |
| 分支 | 57.52% | 70%  | ⚠️   |
| 函数 | 39.82% | 75%  | ⚠️   |
| 行   | 2.93%  | 85%  | ❌   |

> 注：高分支覆盖率与低语句覆盖率并存 → 说明少量文件测试集中但整体缺口巨大。

## 🧩 模块现状分类

| 领域        | 状态    | 说明                                    |
| ----------- | ------- | --------------------------------------- |
| Stores      | ✅ 良好 | user/content/news/resource 有较完善用例 |
| Utils       | ✅ 良好 | apiErrorHandler / debounce 等完备       |
| API Modules | ❌ 缺失 | 仅零散调用路径覆盖                      |
| Components  | ❌ 缺失 | UI / 表单 / 布局几乎无测试              |
| Views 页面  | ❌ 缺失 | 无页面级测试                            |
| Composables | ❌ 缺失 | usePermission 等未覆盖                  |
| Services    | ❌ 缺失 | src/services/ 空白                      |
| Router      | ❌ 缺失 | 导航守卫与路由流程无覆盖                |
| E2E         | ⚠️ 部分 | Playwright 配置存在，场景不足           |
| 性能/内存   | ❌ 缺失 | 仅示例性片段 / 未系统化                 |

## 🚨 失败/不稳定测试清单

| 文件                | 问题         | 原因               | 处理优先级 |
| ------------------- | ------------ | ------------------ | ---------- |
| api.test.ts         | Mock 缺导出  | createApi 结构变动 | 🔴         |
| logger.test.ts      | ENV 判断失败 | 设置时机错误       | 🟡         |
| performance.test.ts | 类型错误     | Mock 不完整        | 🟡         |

## 🧪 数据与工厂

| 资源      | 现状          | 问题                          |
| --------- | ------------- | ----------------------------- |
| factories | 有 user/news  | 范围窄，缺 resource / setting |
| mocks     | 有 API / 组件 | 分散，缺统一注册入口          |
| setup.ts  | 有基础 stub   | 未包含全局重置策略            |

## 🔍 差距分析要点

1. 组件层 0 覆盖 → UI 变更无保护
2. API 与服务逻辑无人值守 → 容易回归破坏契约
3. 覆盖提升需建立“新增即测试”文化门禁
4. 分阶段执行需避免“先写计划后遗忘” → 引入里程碑追踪

## 🧭 首批改进候选 (Top 10 Impact)

| 顺序 | 主题                        | 预期收益               |
| ---- | --------------------------- | ---------------------- |
| 1    | 修复失败测试                | 基线健康 & CI 信任恢复 |
| 2    | API 核心模块单测            | 保护数据契约           |
| 3    | usePermission / 最近浏览    | 权限 & 用户体验逻辑    |
| 4    | 登录流程集成                | 账户体系基础           |
| 5    | 新闻创建工作流              | 关键业务主干           |
| 6    | 资源上传流程                | 文件处理敏感路径       |
| 7    | 组件通用库 (Button / Table) | 减少复制缺陷           |
| 8    | DataTable 分页/过滤         | 高交互复杂度区         |
| 9    | 设置更新缓存失效            | 运维一致性             |
| 10   | 仪表盘聚合接口              | 后续指标拓展基线       |

## 🛡️ 当前风险等级

| 维度     | 风险 | 说明                         |
| -------- | ---- | ---------------------------- |
| 回归     | 高   | 大量未覆盖变更易破坏上线功能 |
| 发布信心 | 中   | 缺少烟雾测试脚本             |
| 安全边界 | 中   | 权限判定尚未测试覆盖         |
| 性能退化 | 中   | 缺指标或性能基准用例         |

## 🧱 清理需求

| 项目         | 状态   | 说明                    |
| ------------ | ------ | ----------------------- |
| 过时计划片段 | 待清理 | 与新 roadmap 合并后归档 |
| 冗余测试样例 | 少量   | 统一风格后重写          |
| 未使用工厂   | 多     | 汇总后按领域补全        |

---

更新本文件需：

1. 执行一次覆盖率统计（CI）
2. 对比差异（↓ 警告 / ↑ 记录）
3. Roadmap 调整条目（若目标变化）
