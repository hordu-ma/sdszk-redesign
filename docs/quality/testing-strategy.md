---
title: 测试总体策略
updated: 2025-09-29
status: draft
owner: qa-team
---

# 测试总体策略

本文件定义测试金字塔、覆盖目标与组织方式。执行计划与当前差距评估请见：`testing-baseline.md` 与 `testing-roadmap.md`。

## 🎯 目标

| 维度         | 目标     | 备注                   |
| ------------ | -------- | ---------------------- |
| 语句覆盖率   | ≥ 85%    | 严格门禁在 75% (PR)    |
| 核心模块覆盖 | 90%+     | Store / Service / 权限 |
| 回归稳定性   | 0 flaky  | 标记 & 隔离策略        |
| 执行时长     | < 10m CI | 单测 < 2m / E2E 并行   |

## 🏗️ 金字塔结构

```
E2E (少)    ← 关键用户旅程 / 回归
集成 (适量) ← 路由 + Store + API 合作
单元 (多)   ← 纯逻辑 / 组合函数 / 工具
```

## 📦 测试类型表

| 类型     | 工具                    | 关注点               | 示例                         |
| -------- | ----------------------- | -------------------- | ---------------------------- |
| 单元     | Vitest + vue-test-utils | 纯逻辑、分支         | 工具函数、Pinia、composables |
| 集成     | Vitest + MSW            | API 协作、Store 流程 | 登录-拉取用户-权限过滤       |
| E2E      | Playwright              | 用户关键路径         | 登录→发布新闻→登出           |
| 性能     | 自定义 + browser perf   | 渲染时长 / 内存      | 大列表渲染                   |
| 可访问性 | axe (规划)              | a11y 违规            | 表单标签关联                 |

## 🧪 覆盖策略

| 区域        | 策略                | 不测内容            |
| ----------- | ------------------- | ------------------- |
| 组件        | 数据驱动 / 交互行为 | UI 纯样式           |
| Store       | 状态迁移 / 错误分支 | 依赖后端真实 IO     |
| API         | 参数构建 / 错误适配 | 第三方 SDK 内部实现 |
| Composables | 分支 + 边界条件     | 纯 re-export        |
| 权限        | matrix 组合         | 重复等价路径        |

## 🔌 Mock 原则

1. 只 Mock 边界（网络 / 时间 / 随机 / 外部服务）
2. 不 Mock 被测逻辑内部实现
3. 工厂函数生成动态数据，避免硬编码
4. 失败路径必须有用例（≥ 1/接口）

## 🧱 目录规划

```
__tests__/
  unit/
  integration/
  e2e/
  factories/
  mocks/
  performance/
  setup.ts
```

## ✅ 质量门禁 (PR)

| 检查项   | 标准                  |
| -------- | --------------------- |
| 单测通过 | 0 失败 / 0 跳过无备注 |
| 覆盖率   | 不低于 main 分支基线  |
| 类型检查 | 0 error               |
| Lint     | 0 error (warn < 10)   |
| E2E 冒烟 | 登录 + 核心页面 200   |

## 🚦 Flaky 处理流程

发现 → 标记 @flaky 注释 → issue → 临时隔离 (retry=2) → 根因修复 → 移除标记。

## 🛠️ 本地开发命令 (建议)

- `npm run test:unit` → 纯单元
- `npm run test:changed` → 仅改动文件
- `npm run test:watch` → watch 模式
- `npm run test:e2e:smoke` → 精简冒烟

## 📌 不在范围 (当前阶段)

- 视觉回归测试 (可列为后续增强)
- 负载压测（需后端独立环境）

## 🔄 维护策略

- 每周：覆盖率趋势板 + 失败统计
- 每月：策略回顾（是否需引入新层次）
- 新模块：提交需附测试或列入补测任务

---

更新本文件需同步 `testing-roadmap.md` 中里程碑，如调整目标阈值。
