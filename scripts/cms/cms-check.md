# CMS健康检查工具使用说明

## 概述

本工具集为山东省思政课一体化中心CMS系统提供自动化健康检查功能，能够快速发现和定位CMS系统中的各种问题。

## 工具组成

```
scripts/cms/
├── check-cms-all.sh      # 主入口脚本
├── cms-health-check.js   # 页面可达性检查
├── cms-function-test.js  # 核心功能测试
└── README.md            # 使用说明
```

## 快速开始

### 1. 启动开发环境

首先确保开发环境正在运行：

```bash
# 启动开发环境
./scripts/development/dev-start.sh
```

### 2. 执行健康检查

```bash
# 执行完整的CMS健康检查
./scripts/cms/check-cms-all.sh
```

## 检查内容

### 页面可达性检查

- ✅ 管理后台首页
- ✅ 新闻管理模块（列表、分类、创建）
- ✅ 资源管理模块（列表、分类、创建）
- ✅ 用户管理模块（用户、角色、权限）

### API端点检查

- ✅ API健康状态
- ✅ 新闻相关API
- ✅ 资源相关API
- ✅ 用户管理API

### 核心功能检查

- ✅ 页面加载状态
- ✅ JavaScript错误监测
- ✅ 网络请求失败检测
- ✅ 数据库连接验证

## 输出结果

### 控制台输出

检查过程中会实时显示结果：

- ✅ 成功项目（绿色）
- ❌ 错误项目（红色）
- ⚠️ 警告项目（黄色）
- ℹ️ 信息提示（蓝色）

### 详细报告

检查完成后会生成详细报告文件：

```
.cms-reports/
├── cms-health-YYYYMMDD_HHMMSS.log    # 详细日志
└── screenshots/                      # 错误截图
    ├── 页面名称-error.png
    └── 页面名称-exception.png
```

### 结果统计

```
检查完成统计:
成功: 8 项
警告: 1 项
错误: 0 项
```

## 常见问题

### Q: 提示"前端服务未启动"

**A:** 确保开发环境已启动：

```bash
./scripts/development/dev-start.sh
```

### Q: 提示"需要登录访问"

**A:** 工具会尝试自动登录，如果失败会跳过需要认证的页面。这是正常现象。

### Q: 检查失败怎么办？

**A:** 查看生成的报告文件，其中包含详细的错误信息和截图。

## 高级用法

### 单独运行某个检查

```bash
# 只检查页面可达性
node scripts/cms/cms-health-check.js

# 只检查核心功能
node scripts/cms/cms-function-test.js
```

### 查看历史报告

```bash
# 查看最新报告
ls -la .cms-reports/

# 查看特定报告
cat .cms-reports/cms-health-20240101_120000.log
```

## 集成到开发流程

### 开发前检查

```bash
# 在开始开发前运行
./scripts/cms/check-cms-all.sh
```

### 提交前验证

```bash
# 在代码提交前验证
git add . && ./scripts/cms/check-cms-all.sh && git commit -m "feat: 新功能"
```

### 定期维护

建议每周运行一次完整检查，确保系统健康状态。

## 技术说明

- **运行环境**: Node.js + Playwright
- **浏览器**: Chromium (无头模式)
- **超时设置**: 30秒
- **依赖检查**: 自动检测前后端服务状态

## 注意事项

1. 确保端口5173和3000未被其他程序占用
2. 检查过程中请勿手动操作浏览器
3. 网络异常可能导致部分检查失败
4. 首次运行可能需要下载Playwright浏览器

## 故障排除

如果遇到问题，请按以下步骤排查：

1. 检查开发环境是否正常运行
2. 查看详细报告文件中的错误信息
3. 检查截图文件了解页面状态
4. 必要时重启开发环境后重试

---

**版本**: v1.0
**更新时间**: $(date +"%Y-%m-%d")
**维护者**: 开发团队
