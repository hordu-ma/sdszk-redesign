# 生产环境部署清单 (Production Deployment Checklist)

本清单旨在提供一个从准备到完成的标准化部署流程，以确保每次上线的专业性、稳定性和可控性。遵循此清单有助于最小化风险、保证质量并使整个发布过程更加顺畅。

---

## 阶段一：部署前 (Pre-Deployment)

**核心目标：将风险降至最低，确保部署过程的可预测性和可回滚性。**

### 1. 版本与代码管理 (Code & Versioning)
- [ ] **功能冻结 (Feature Freeze)**: 宣布暂停向 `main` 分支合并新的功能代码，只允许合入用于修复严重 Bug 的代码，以确保部署版本的稳定性。
- [ ] **创建发布标签 (Git Tagging)**: 在 `main` 分支上，为你准备部署的这个提交（commit）创建一个 Git 标签（例如 `v1.0.0`）。
    - **目的**: 精确追踪线上运行的代码版本，并在需要时能够轻松回滚。

### 2. 最终验证 (Final Verification)
- [ ] **建立预发/准生产环境 (Staging Environment)**: （如果已有）确保预发环境是生产环境的完整镜像。
- [ ] **在预发环境部署**: 在部署到生产环境前，先将代码完整部署到预发环境。
- [ ] **在预发环境完整测试**: 针对预发环境，完整地运行所有测试（单元、集成、E2E），这是验证生产构建和配置是否正确的最后机会。
- [ ] **手动验收 (Smoke Testing)**: 在预发环境对核心业务流程进行手动测试（例如用户注册、登录、访问核心资源等）。

### 3. 配置与数据 (Configuration & Data)
- [ ] **环境变量最终审查**: 再次逐一确认生产环境的配置文件（如 `.env.aliyun` 和 `server/.env.production`）中的每一个变量是否正确。
- [ ] **数据库备份 (CRITICAL!)**: 在执行任何数据库结构变更（Migrations）或部署操作之前，**必须对生产数据库做一个完整的、可恢复的备份**。
- [ ] **迁移脚本审查**: 检查并测试你的数据库迁移脚本，确保它们可以在生产数据库上正确无误地执行。

### 4. 部署与回滚预案 (Deployment & Rollback Plan)
- [ ] **审查部署脚本**: 和团队一起逐行阅读 `deploy.sh`, `deploy-backend.sh` 等部署脚本，确保每个人都理解其作用和潜在影响。
- [ ] **制定回滚计划**: 提前制定清晰的失败预案。
    - **应用回滚**: 如何快速地使用上一个 Git 标签重新部署旧版本的应用。
    - **数据库回滚**: 如何使用部署前创建的备份来恢复数据库。
- [ ] **通知利益相关者**: 如果可能影响用户，提前发布停机维护公告。

---

## 阶段二：部署后 (Post-Deployment)

**核心目标：确认部署成功，监控系统健康度，并能快速响应问题。**

### 1. 即时验证 (Immediate Verification)
- [ ] **线上冒烟测试**: 部署一完成，立即访问线上应用，手动测试核心功能是否正常。
- [ ] **检查应用日志**: 立刻登录服务器，查看 Nginx 和 PM2 的日志，确认应用已正常启动且没有抛出任何严重错误。

### 2. 监控与观察 (Monitoring & Observability)
- [ ] **服务器性能监控**: 在阿里云控制台密切关注服务器的 CPU、内存、网络流量等指标，确保没有因为新版本的代码而出现异常。
- [ ] **错误追踪**: 关注错误监控工具（如 Sentry）或保持对日志的监控，检查是否有新的、未预见的错误上报。
- [ ] **业务指标监控**: 检查网站分析工具，确认用户流量、转化率等核心业务指标没有异常下跌。

### 3. 流程与沟通 (Process & Communication)
- [ ] **宣布部署完成**: 通知所有利益相关者，部署已完成，服务恢复正常。
- [ ] **团队待命**: 部署完成后的至少一个小时内，核心开发团队应处于待命状态，以便快速响应和修复可能出现的紧急问题。
- [ ] **部署复盘 (Retrospective)**: 在部署稳定后，组织一次简短的复盘会议。讨论哪些做得好，哪些可以改进，持续优化部署流程。
