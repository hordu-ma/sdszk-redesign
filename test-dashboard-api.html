<!doctype html>
<html>
  <head>
    <title>Dashboard API 测试</title>
  </head>
  <body>
    <h1>Dashboard API 测试</h1>
    <div id="results"></div>

    <script>
      async function testDashboardAPI() {
        const resultsDiv = document.getElementById("results");

        try {
          // 1. 先登录获取token
          resultsDiv.innerHTML += "<p>正在登录...</p>";
          const loginResponse = await fetch(
            "http://localhost:3000/api/auth/login",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                username: "admin",
                password: "admin123",
              }),
              credentials: "include",
            }
          );

          const loginData = await loginResponse.json();
          resultsDiv.innerHTML +=
            "<p>登录响应: " + JSON.stringify(loginData, null, 2) + "</p>";

          if (loginData.status === "success" && loginData.token) {
            const token = loginData.token;
            resultsDiv.innerHTML += "<p>登录成功，token: " + token + "</p>";

            // 2. 调用Dashboard API
            resultsDiv.innerHTML += "<p>正在调用Dashboard API...</p>";
            const dashboardResponse = await fetch(
              "http://localhost:3000/api/admin/dashboard/stats",
              {
                headers: {
                  Authorization: "Bearer " + token,
                  "Content-Type": "application/json",
                },
              }
            );

            const dashboardData = await dashboardResponse.json();
            resultsDiv.innerHTML +=
              "<p>Dashboard API响应: " +
              JSON.stringify(dashboardData, null, 2) +
              "</p>";
          } else {
            resultsDiv.innerHTML += "<p>登录失败!</p>";
          }
        } catch (error) {
          resultsDiv.innerHTML += "<p>错误: " + error.message + "</p>";
          console.error("错误:", error);
        }
      }

      // 页面加载后执行测试
      testDashboardAPI();
    </script>
  </body>
</html>
