# å±±ä¸œçœæ€æ”¿è¯¾ä¸€ä½“åŒ–ä¸­å¿ƒ - å¼€å‘æŒ‡å—

> ç²¾ç®€ç‰ˆå¼€å‘æŒ‡å—ï¼Œä¸“æ³¨æ ¸å¿ƒæµç¨‹å’Œå…³é”®ä¿¡æ¯

## ğŸ¯ é¡¹ç›®æ¦‚è§ˆ

| é¡¹ç›®ä¿¡æ¯     | å†…å®¹                               |
| ------------ | ---------------------------------- |
| **é¡¹ç›®åç§°** | å±±ä¸œçœæ€æƒ³æ”¿æ²»ç†è®ºè¯¾ä¸€ä½“åŒ–æ•™è‚²å¹³å° |
| **ç”Ÿäº§åŸŸå** | https://horsduroot.com             |
| **æœåŠ¡å™¨**   | é˜¿é‡Œäº‘ECS (60.205.124.67)          |
| **ç®¡ç†åå°** | https://horsduroot.com/admin       |
| **æ¶æ„ç±»å‹** | Vue3å‰ç«¯ + Node.jsåç«¯ + MongoDB   |

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

**å‰ç«¯**: Vue 3.3.4 + TypeScript + Vite + Element Plus
**åç«¯**: Node.js + Express + MongoDB + JWTè®¤è¯
**éƒ¨ç½²**: PM2 + Nginx + SSL + é˜¿é‡Œäº‘ECS

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# å‰ç«¯éƒ¨ç½²
./scripts/deployment/deploy.sh

# åç«¯éƒ¨ç½²
./scripts/deployment/deploy-backend.sh

# Nginxé…ç½®éƒ¨ç½²ï¼ˆé…ç½®å˜æ›´æ—¶ï¼‰
./scripts/deployment/deploy-nginx.sh
```

### éƒ¨ç½²ç‰¹æ€§

âœ… **è‡ªåŠ¨å¤‡ä»½ä¸å›æ»š** - éƒ¨ç½²å¤±è´¥è‡ªåŠ¨æ¢å¤
âœ… **å¥åº·æ£€æŸ¥** - éƒ¨ç½²åè‡ªåŠ¨éªŒè¯æœåŠ¡çŠ¶æ€
âœ… **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯æ£€æµ‹å’Œæ—¥å¿—è®°å½•
âœ… **éƒ¨ç½²é”** - é˜²æ­¢å¹¶å‘éƒ¨ç½²å†²çª
âœ… **Pre-flightæ£€æŸ¥** - éƒ¨ç½²å‰éªŒè¯ç¯å¢ƒå’Œä¾èµ–

### ç¯å¢ƒé…ç½®

```bash
# å‰ç«¯ç¯å¢ƒæ–‡ä»¶
.env.aliyun          # é˜¿é‡Œäº‘ç”Ÿäº§ç¯å¢ƒé…ç½®

# åç«¯ç¯å¢ƒæ–‡ä»¶
server/.env          # å¼€å‘ç¯å¢ƒé…ç½®
server/.env.production  # ç”Ÿäº§ç¯å¢ƒé…ç½®
```

## ğŸ”§ å¼€å‘ç¯å¢ƒ

### æœ¬åœ°å¯åŠ¨

```bash
# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
npm run dev

# å¯åŠ¨åç«¯APIæœåŠ¡å™¨
npm run server:dev

# å¯åŠ¨æ•°æ®åº“
npm run dev:db
```

### è‡ªåŠ¨åŒ–è„šæœ¬

```bash
# ä¸€é”®å¯åŠ¨å¼€å‘ç¯å¢ƒ
./scripts/development/dev-start.sh

# ä¸€é”®åœæ­¢å¼€å‘ç¯å¢ƒ
./scripts/development/dev-stop.sh

# ç¯å¢ƒè¯Šæ–­
./scripts/development/dev-health.sh
```

## ğŸ’¾ æ•°æ®åº“ç®¡ç†

### æ ¸å¿ƒè„šæœ¬

```bash
# å¿«é€ŸåŒæ­¥ç”Ÿäº§æ•°æ®åˆ°æœ¬åœ°
./scripts/database/quick-sync.sh

# å®Œæ•´æ•°æ®åº“åŒæ­¥å·¥å…·
./scripts/database/sync-database.sh

# æ•°æ®åº“éªŒè¯
./scripts/database/verify-database.sh

# SSHéš§é“è¿æ¥ï¼ˆåªè¯»ï¼‰
./scripts/database/mongodb-tunnel.sh
```

### æ•°æ®åº“é…ç½®

- **ç”Ÿäº§**: MongoDB Atlas / é˜¿é‡Œäº‘MongoDB
- **å¼€å‘**: æœ¬åœ°MongoDB (sdszkæ•°æ®åº“)
- **è¿æ¥**: ç»Ÿä¸€ä½¿ç”¨ `sdszk` æ•°æ®åº“å

## ğŸ“ æ ¸å¿ƒé¡¹ç›®ç»“æ„

```
sdszk-redesign/
â”œâ”€â”€ src/                    # å‰ç«¯æºä»£ç 
â”‚   â”œâ”€â”€ views/             # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ components/        # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ api/              # APIæ¥å£
â”‚   â””â”€â”€ stores/           # PiniaçŠ¶æ€ç®¡ç†
â”œâ”€â”€ server/               # åç«¯æºä»£ç 
â”‚   â”œâ”€â”€ app.js           # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ routes/          # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ middleware/      # ä¸­é—´ä»¶
â””â”€â”€ scripts/             # è‡ªåŠ¨åŒ–è„šæœ¬
    â”œâ”€â”€ deployment/      # éƒ¨ç½²è„šæœ¬
    â”œâ”€â”€ development/     # å¼€å‘è„šæœ¬
    â””â”€â”€ database/        # æ•°æ®åº“è„šæœ¬
```

## ğŸ”— æ ¸å¿ƒAPIè·¯ç”±

### å‰å°æ¥å£

- `/api/news` - æ–°é—»èµ„è®¯
- `/api/resources` - æ•™å­¦èµ„æº
- `/api/auth` - ç”¨æˆ·è®¤è¯

### åå°æ¥å£

- `/api/admin/news` - æ–°é—»ç®¡ç†
- `/api/admin/resources` - èµ„æºç®¡ç†
- `/api/admin/users` - ç”¨æˆ·ç®¡ç†

## ğŸ¯ éƒ¨ç½²æµç¨‹è¯¦è§£

### 1. å‰ç«¯éƒ¨ç½²æµç¨‹

```bash
./scripts/deployment/deploy.sh
```

**æ‰§è¡Œæ­¥éª¤**:

1. Pre-flightæ£€æŸ¥ï¼ˆå·¥å…·ã€SSHè¿æ¥ã€GitçŠ¶æ€ï¼‰
2. æ„å»ºå‰ç«¯é¡¹ç›®ï¼ˆVite + TypeScriptï¼‰
3. åˆ›å»ºæœåŠ¡å™¨å¤‡ä»½
4. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
5. è®¾ç½®æ–‡ä»¶æƒé™
6. é‡è½½Nginxé…ç½®
7. å¥åº·æ£€æŸ¥éªŒè¯
8. ç”Ÿæˆéƒ¨ç½²æŠ¥å‘Š

### 2. åç«¯éƒ¨ç½²æµç¨‹

```bash
./scripts/deployment/deploy-backend.sh
```

**æ‰§è¡Œæ­¥éª¤**:

1. Pre-flightæ£€æŸ¥ï¼ˆNode.jsã€é…ç½®æ–‡ä»¶ã€PM2ï¼‰
2. éš”ç¦»ç¯å¢ƒæ„å»ºé¡¹ç›®
3. å®‰è£…ç”Ÿäº§ä¾èµ–
4. æ‰“åŒ…éƒ¨ç½²æ–‡ä»¶
5. åˆ›å»ºæœåŠ¡å™¨å¤‡ä»½
6. ä¸Šä¼ å¹¶è§£å‹éƒ¨ç½²åŒ…
7. PM2é‡å¯æœåŠ¡
8. å¥åº·æ£€æŸ¥éªŒè¯
9. ç”Ÿæˆéƒ¨ç½²æŠ¥å‘Š

### 3. å›æ»šæœºåˆ¶

æ¯æ¬¡éƒ¨ç½²éƒ½ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½ï¼Œå¦‚éœ€å›æ»šï¼š

```bash
# æŸ¥çœ‹å›æ»šä¿¡æ¯æ–‡ä»¶
ls /tmp/*-rollback-*.info

# ä½¿ç”¨å›æ»šä¿¡æ¯æ‰‹åŠ¨æ¢å¤
source /tmp/frontend-rollback-XXXXXX.info
ssh $SERVER_USER@$SERVER_IP "mv $BACKUP_DIR $DEPLOY_PATH"
```

## ğŸ” æ•…éšœæ’æŸ¥

### éƒ¨ç½²é—®é¢˜

```bash
# æ£€æŸ¥éƒ¨ç½²é”
ls /tmp/*-deploy.lock

# æŸ¥çœ‹æœ€è¿‘éƒ¨ç½²æ—¥å¿—
ssh root@60.205.124.67 "pm2 logs sdszk-backend --lines 50"

# æ£€æŸ¥NginxçŠ¶æ€
ssh root@60.205.124.67 "nginx -t && systemctl status nginx"
```

### æœåŠ¡çŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
ssh root@60.205.124.67 "pm2 status && systemctl status nginx"

# æ£€æŸ¥ç«¯å£å ç”¨
ssh root@60.205.124.67 "netstat -tlnp | grep ':3000'"

# æµ‹è¯•ç½‘ç«™è®¿é—®
curl -I https://horsduroot.com
```

### å¸¸è§é”™è¯¯è§£å†³

| é”™è¯¯ç±»å‹       | æ£€æŸ¥æ–¹æ³•            | è§£å†³æ–¹æ¡ˆ                    |
| -------------- | ------------------- | --------------------------- |
| éƒ¨ç½²å¤±è´¥       | æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—        | ä½¿ç”¨è‡ªåŠ¨å›æ»šæˆ–æ‰‹åŠ¨æ¢å¤å¤‡ä»½  |
| æœåŠ¡æ— å“åº”     | `pm2 status`        | `pm2 restart sdszk-backend` |
| Nginxé”™è¯¯      | `nginx -t`          | æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•            |
| æ•°æ®åº“è¿æ¥å¤±è´¥ | æ£€æŸ¥.env.production | éªŒè¯MONGODB_URIé…ç½®         |

## ğŸ“Š NPMè„šæœ¬é€ŸæŸ¥

### å¼€å‘è„šæœ¬

```bash
npm run dev              # å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
npm run server:dev       # å¯åŠ¨åç«¯å¼€å‘æœåŠ¡å™¨
npm run dev:db          # å¯åŠ¨æœ¬åœ°æ•°æ®åº“
```

### æ„å»ºè„šæœ¬

```bash
npm run build:aliyun    # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run preview         # é¢„è§ˆæ„å»ºç»“æœ
```

### éƒ¨ç½²è„šæœ¬

```bash
npm run deploy:frontend  # ç­‰åŒäº ./scripts/deployment/deploy.sh
npm run deploy:backend   # ç­‰åŒäº ./scripts/deployment/deploy-backend.sh
```

### æµ‹è¯•è„šæœ¬

```bash
npm run test            # è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:e2e        # è¿è¡ŒE2Eæµ‹è¯•
npm run lint            # ä»£ç æ£€æŸ¥
```

## ğŸŠ å¿«é€ŸéªŒè¯

### éªŒè¯å¼€å‘ç¯å¢ƒ

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡æ˜¯å¦æ­£å¸¸
curl http://localhost:5173        # å‰ç«¯æœåŠ¡
curl http://localhost:3000/api/health  # åç«¯API
mongosh --eval "db.adminCommand('ping')"  # æ•°æ®åº“
```

### éªŒè¯ç”Ÿäº§ç¯å¢ƒ

```bash
# æ£€æŸ¥ç½‘ç«™è®¿é—®
curl -I https://horsduroot.com
curl -I https://www.horsduroot.com

# æ£€æŸ¥APIæœåŠ¡
curl https://horsduroot.com/api/health

# æ£€æŸ¥ç®¡ç†åå°
curl -I https://horsduroot.com/admin
```

## ğŸ“š é‡è¦æé†’

1. **éƒ¨ç½²å‰** - ç¡®ä¿ä»£ç å·²æäº¤ï¼Œæµ‹è¯•é€šè¿‡
2. **éƒ¨ç½²ä¸­** - è§‚å¯Ÿæ—¥å¿—è¾“å‡ºï¼Œæ³¨æ„é”™è¯¯ä¿¡æ¯
3. **éƒ¨ç½²å** - éªŒè¯ç½‘ç«™åŠŸèƒ½ï¼Œæ£€æŸ¥æœåŠ¡çŠ¶æ€
4. **ç´§æ€¥æƒ…å†µ** - ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„å›æ»šä¿¡æ¯å¿«é€Ÿæ¢å¤

---

**æ›´æ–°æ—¥æœŸ**: 2025-09-03
**ç‰ˆæœ¬**: 2.0 - å®‰å…¨å¢å¼ºç‰ˆéƒ¨ç½²è„šæœ¬
